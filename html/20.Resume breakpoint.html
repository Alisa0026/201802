<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>珠峰培训架构2期</title>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css">
</head>
<body>
<div class="nav">
    <div class="logo">
        
            珠峰培训架构2期
        
    </div>
<ul><li><a href="../index.html">0.es6</a></li><li><a href="../html/1.async.html">1.async</a></li><li><a href="../html/2.async.html">2.async</a></li><li><a href="../html/3.async.html">3.async</a></li><li><a href="../html/4.node.html">4.node</a></li><li><a href="../html/5.nodeInstall.html">5.nodeInstall</a></li><li><a href="../html/6.REPL.html">6.REPL</a></li><li><a href="../html/7.global.html">7.global</a></li><li><a href="../html/8.module&NPM.html">8.module&NPM</a></li><li><a href="../html/9.NodeCore.html">9.NodeCore</a></li><li><a href="../html/10.Encoding.html">10.Encoding</a></li><li><a href="../html/11.Buffer.html">11.Buffer</a></li><li><a href="../html/12.fs.html">12.fs</a></li><li><a href="../html/13.Stream-1.html">13.Stream-1</a></li><li><a href="../html/14.Stream-2.html">14.Stream-2</a></li><li><a href="../html/15.Stream-3.html">15.Stream-3</a></li><li><a href="../html/16.Stream-4.html">16.Stream-4</a></li><li><a href="../html/17.tcp.html">17.tcp</a></li><li><a href="../html/18.http-1.html">18.http-1</a></li><li><a href="../html/19.action.html">19.action</a></li><li class="active"><a href="../html/20.Resume breakpoint.html">20.Resume breakpoint</a></li><li><a href="../html/21.crypto.html">21.crypto</a></li><li><a href="../html/22.cache.html">22.cache</a></li><li><a href="../html/23.yargs.html">23.yargs</a></li><li><a href="../html/24.process.html">24.process</a></li><li><a href="../html/25.compress.html">25.compress</a></li><li><a href="../html/26.koa.html">26.koa</a></li><li><a href="../html/27.webpack.html">27.webpack</a></li><li><a href="../html/28.webpack-2.html">28.webpack-2</a></li></ul></div>


<div class="warpper">

    <div class="page-toc">
        <ul><li><a href="#t0Range">Range</a></li><li><a href="#t1获取部分内容的范围请求">获取部分内容的范围请求</a></li><li><a href="#t2如何应用">如何应用</a><ul><li><a href="#t31.1 服务端设置">1.1 服务端设置</a></li><li><a href="#t41.2 客户端设置">1.2 客户端设置</a></li></ul></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h2 id="t0Range">Range <a href="#t0Range"> # </a></h2>
<p>&#x5F53;&#x7528;&#x6237;&#x5728;&#x542C;&#x4E00;&#x9996;&#x6B4C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x542C;&#x5230;&#x4E00;&#x534A;&#xFF08;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;&#x4E86;&#x4E00;&#x534A;&#xFF09;&#xFF0C;&#x7F51;&#x7EDC;&#x65AD;&#x6389;&#x4E86;&#xFF0C;&#x7528;&#x6237;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x542C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6587;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x65AD;&#x70B9;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x7528;&#x6237;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x800C;Range&#x652F;&#x6301;&#x7684;&#x8BDD;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x8BE5;&#x8BB0;&#x5F55;&#x4E86;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x7684;&#x6587;&#x4EF6;&#x8303;&#x56F4;&#xFF0C;&#x7F51;&#x7EDC;&#x6062;&#x590D;&#x4E4B;&#x540E;&#xFF0C;&#x5219;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x8BFB;&#x53D6;&#x5269;&#x4F59;Range&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x53EA;&#x9700;&#x8981;&#x53D1;&#x9001;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;&#x90A3;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x53D1;&#x9001;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4EE5;&#x6B64;&#x8282;&#x7701;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;&#x3002;</p>
<h2 id="t1&#x83B7;&#x53D6;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x7684;&#x8303;&#x56F4;&#x8BF7;&#x6C42;">&#x83B7;&#x53D6;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x7684;&#x8303;&#x56F4;&#x8BF7;&#x6C42; <a href="#t1&#x83B7;&#x53D6;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x7684;&#x8303;&#x56F4;&#x8BF7;&#x6C42;"> # </a></h2>
<p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x4E2D;&#x65AD;&#x6062;&#x590D;&#x4E0B;&#x8F7D;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x80FD;&#x4E0B;&#x8F7D;&#x6307;&#x5B9A;&#x4E0B;&#x8F7D;&#x7684;&#x5B9E;&#x4F53;&#x8303;&#x56F4;</p>
<ul>
<li>&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x7684;Range&#x6765;&#x6307;&#x5B9A; &#x8D44;&#x6E90;&#x7684;byte&#x8303;&#x56F4;</li>
<li>&#x54CD;&#x5E94;&#x4F1A;&#x8FD4;&#x56DE;&#x72B6;&#x6001;&#x7801;206&#x54CD;&#x5E94;&#x62A5;&#x6587;</li>
<li>&#x5BF9;&#x4E8E;&#x591A;&#x91CD;&#x8303;&#x56F4;&#x7684;&#x8303;&#x56F4;&#x8BF7;&#x6C42;&#xFF0C;&#x54CD;&#x5E94;&#x4F1A;&#x5728;&#x9996;&#x90E8;&#x5B57;&#x6BB5;<code>Content-Type</code>&#x4E2D;&#x6807;&#x660E;<code>multipart/byteranges</code></li>
<li><img src="http://img.zhufengpeixun.cn/partial.png" alt="partial"></li>
<li><img src="http://img.zhufengpeixun.cn/bytes.png" alt="bytes"></li>
</ul>
<pre><code>curl -v --header &quot;Range: bytes=2-100&quot; http://www.zhufengpeixun.cn/skin/20142/img/logo.png
</code></pre><h2 id="t2&#x5982;&#x4F55;&#x5E94;&#x7528;">&#x5982;&#x4F55;&#x5E94;&#x7528; <a href="#t2&#x5982;&#x4F55;&#x5E94;&#x7528;"> # </a></h2>
<ul>
<li><p>&#x5982;&#x679C;Server&#x652F;&#x6301;Range&#xFF0C;&#x9996;&#x5148;&#x5C31;&#x8981;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x652F;&#x6301;Range&#xFF0C;&#x4E4B;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x624D;&#x53EF;&#x80FD;&#x53D1;&#x8D77;&#x5E26;Range&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x91CC;&#x5957;&#x7528;&#x5510;&#x50E7;&#x7684;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x4F60;&#x4E0D;&#x8BF4;&#x6211;&#x600E;&#x4E48;&#x77E5;&#x9053;&#x5462;&#x3002;response.setHeader(&apos;Accept-Ranges&apos;, &apos;bytes&apos;);</p>
</li>
<li><p>Server&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x7684;<code>Range: bytes=0-xxx</code>&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x505A;Range&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x503C;&#x5B58;&#x5728;&#x800C;&#x4E14;&#x6709;&#x6548;&#xFF0C;&#x5219;&#x53EA;&#x53D1;&#x56DE;&#x8BF7;&#x6C42;&#x7684;&#x90A3;&#x90E8;&#x5206;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF0C;&#x54CD;&#x5E94;&#x7684;&#x72B6;&#x6001;&#x7801;&#x53D8;&#x6210;206&#xFF0C;&#x8868;&#x793A;Partial Content&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;Content-Range&#x3002;&#x5982;&#x679C;&#x65E0;&#x6548;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;416&#x72B6;&#x6001;&#x7801;&#xFF0C;&#x8868;&#x660E;Request Range Not </p>
</li>
</ul>
<h4 id="t31.1 &#x670D;&#x52A1;&#x7AEF;&#x8BBE;&#x7F6E;">1.1 &#x670D;&#x52A1;&#x7AEF;&#x8BBE;&#x7F6E; <a href="#t31.1 &#x670D;&#x52A1;&#x7AEF;&#x8BBE;&#x7F6E;"> # </a></h4>
<pre><code>// server
let http = require(&apos;http&apos;);
let url = require(&apos;url&apos;)
let path = require(&apos;path&apos;);
let fs = require(&apos;fs&apos;);
http.createServer(function(req,res){
    let p = path.join(__dirname,&apos;./1.bytes.txt&apos;);
    let start = 0;
    fs.stat(p,function(err,stat){
        let start = 0
        let end  = stat.size - 1; // &#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F; 
        let range = req.headers[&apos;range&apos;]; 
        if(range){
            res.setHeader(&apos;Accept-Range&apos;,&apos;bytes&apos;);
            res.statusCode = 206;
            let result = range.match(/bytes=(\d*)-(\d*)/);
            if(result){
                start = result[1]? parseInt(result[1]):start;
                end =result[2]? parseInt(result[2])-1:end
            }
        }
        return fs.createReadStream(p,{start,end}).pipe(res);
    })
}).listen(8080);
</code></pre><h4 id="t41.2 &#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;">1.2 &#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E; <a href="#t41.2 &#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;"> # </a></h4>
<pre><code>// client
let options = {
    hostname:&apos;localhost&apos;,
    port:8080,
    path:&apos;/&apos;,
    method:&apos;GET&apos;
}
let fs = require(&apos;fs&apos;);
let path = require(&apos;path&apos;);
let http = require(&apos;http&apos;);
let ws = fs.createWriteStream(&apos;./download.txt&apos;);
let start = 0; 
let pause = false
process.stdin.on(&apos;data&apos;,function(chunk){
    chunk = chunk.toString();
    if(chunk.startsWith(&apos;p&apos;)){
        pause = true;
    }else{
        pause = false;
        downLoad();
    }
})
function downLoad(){
    options.headers = {
        Range: `bytes=${start}-${start+10}`
    }
    start+=10;
    http.request(options,function(response){
        let buffers = []
        response.on(&apos;data&apos;,function(data){
            buffers.push(data);
        });
        response.on(&apos;end&apos;,function(){
            let b = Buffer.concat(buffers);
            ws.write(b);
            if(start&lt;100&amp;&amp;pause === false){
                setTimeout(function(){
                    downLoad()
                },1000)
            }
        })
    })
}
downLoad();
</code></pre>
        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>
    
</div>

<script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.js"></script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
  // if (!$('.understand-me').length) {
  //   var bar = $(window).height() - $('.navbar ').height() - $('.page-toc').position().top;
  //   var count = bar / 26 / 2;
  //   var barHeight = $('.page-toc').outerHeight();
  //   $('.page-toc li').eq(0).children('a').addClass('red');
  //   var arr = [];
  //   $("h1,h2,h3,h4,h5,h6").each(function () {
  //     arr.push($(this).position().top);
  //   });
  //   var timer
  //   function dark() {
  //     clearTimeout(timer)
  //      timer = setTimeout(function () {
  //      var top = Math.abs($('.page-toc > ul').position().top);
  //      var cur = $('.content').scrollTop();
  //      for (var i = arr.length; i >= 0; i--) {
  //        if (arr[i] <= cur) {
  //          break;
  //        }
  //      }
  //      if (i === -1) {
  //        i = 0;
  //      }
  //      $('.page-toc li a').removeClass('red');
  //      $('.page-toc li').eq(i).children('a').addClass('red');
  //      let height = $('.page-toc li').eq(i).position().top-$('.page-toc').height(); // 如果当前的offset出去了 回到中间可好？
  //      $('.page-toc').scrollTop(height+$('.page-toc').height()/2);
  //    },200)
  //   }

  //   $('.content').on('scroll', dark);
  // }
</script>
<style>

    /* ::-webkit-scrollbar{width:14px;}
    ::-webkit-scrollbar-track{background-color:transparent;}
    ::-webkit-scrollbar-thumb{background-color:transparent;}
    ::-webkit-scrollbar-thumb:hover {background-color:transparent}
    ::-webkit-scrollbar-thumb:active {background-color:transparent} */

    .page-toc > ul .red {
        background: #f3f3f3;
        z-index: 1;
        border-left: 3px solid #009a61;
        -webkit-transition: all .2s ease;
        transition: all .2s ease;
        color: #000
    }





</style>
</body>
</html>
