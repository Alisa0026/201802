<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>珠峰培训架构2期</title>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css">
</head>
<body>
<div class="nav">
    <div class="logo">
        
            珠峰培训架构2期
        
    </div>
<ul><li><a href="../index.html">0.es6</a></li><li><a href="../html/1.async.html">1.async</a></li><li><a href="../html/2.async.html">2.async</a></li><li><a href="../html/3.async.html">3.async</a></li><li><a href="../html/4.node.html">4.node</a></li><li><a href="../html/5.nodeInstall.html">5.nodeInstall</a></li><li><a href="../html/6.REPL.html">6.REPL</a></li><li><a href="../html/7.global.html">7.global</a></li><li><a href="../html/8.module&NPM.html">8.module&NPM</a></li><li><a href="../html/9.NodeCore.html">9.NodeCore</a></li><li><a href="../html/10.Encoding.html">10.Encoding</a></li><li><a href="../html/11.Buffer.html">11.Buffer</a></li><li><a href="../html/12.fs.html">12.fs</a></li><li><a href="../html/13.Stream-1.html">13.Stream-1</a></li><li><a href="../html/14.Stream-2.html">14.Stream-2</a></li><li><a href="../html/15.Stream-3.html">15.Stream-3</a></li><li><a href="../html/16.Stream-4.html">16.Stream-4</a></li><li><a href="../html/17.tcp.html">17.tcp</a></li><li><a href="../html/18.http-1.html">18.http-1</a></li><li><a href="../html/19.action.html">19.action</a></li><li><a href="../html/20.Resume breakpoint.html">20.Resume breakpoint</a></li><li><a href="../html/21.crypto.html">21.crypto</a></li><li><a href="../html/22.cache.html">22.cache</a></li><li><a href="../html/23.yargs.html">23.yargs</a></li><li><a href="../html/24.process.html">24.process</a></li><li><a href="../html/25.compress.html">25.compress</a></li><li><a href="../html/26.koa.html">26.koa</a></li><li><a href="../html/27.webpack.html">27.webpack</a></li><li><a href="../html/28.webpack-2.html">28.webpack-2</a></li><li><a href="../html/29.React-1.html">29.React-1</a></li><li class="active"><a href="../html/MVVM.html">MVVM</a></li><li><a href="../html/README.html">README</a></li></ul></div>


<div class="warpper">

    <div class="page-toc">
        <ul><li><a href="#t0来看看目前最火的MVVM">来看看目前最火的MVVM</a></li><li><a href="#t1先来总结下MVVM的实现方式">先来总结下MVVM的实现方式</a></li><li><a href="#t2谈谈现代版的框架">谈谈现代版的框架</a></li><li><a href="#t3总结下实现MVVM都要掌握哪些！">总结下实现MVVM都要掌握哪些！</a></li><li><a href="#t4先简单来说说MVVM">先简单来说说MVVM</a></li><li><a href="#t5Vue基础案例">Vue基础案例</a></li><li><a href="#t6MVVM构建">MVVM构建</a></li><li><a href="#t7模板编译">模板编译</a><ul><li><a href="#t8node2fragment">node2fragment</a></li><li><a href="#t9compile">compile</a></li><li><a href="#t10compileElement&compileText">compileElement&compileText</a></li><li><a href="#t11CompileUtil">CompileUtil</a></li></ul></li><li><a href="#t12数据劫持">数据劫持</a></li><li><a href="#t13Watcher实现">Watcher实现</a></li><li><a href="#t14发布订阅">发布订阅</a></li><li><a href="#t15监听输入事件">监听输入事件</a></li><li><a href="#t16代理数据">代理数据</a></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h2 id="t0&#x6765;&#x770B;&#x770B;&#x76EE;&#x524D;&#x6700;&#x706B;&#x7684;MVVM">&#x6765;&#x770B;&#x770B;&#x76EE;&#x524D;&#x6700;&#x706B;&#x7684;MVVM <a href="#t0&#x6765;&#x770B;&#x770B;&#x76EE;&#x524D;&#x6700;&#x706B;&#x7684;MVVM"> # </a></h2>
<ul>
<li>&#x4ECA;&#x5929;&#x9762;&#x8BD5;&#x53C8;&#x88AB;&#x95EE;&#x5230;&#x4EC0;&#x4E48;&#x662F;MVVM?   </li>
<li>&#x5149;&#x9760;&#x8BF4;&#x7406;&#x8BBA;&#x5DF2;&#x7ECF;&#x7CCA;&#x5F04;&#x4E0D;&#x8FC7;&#x53BB;&#x4E86;?  </li>
<li>&#x4EC0;&#x4E48;!MVVM&#x7684;&#x5B9E;&#x73B0;&#x4E0D;&#x6B62;&#x4E00;&#x79CD;&#x554A;?  </li>
<li>&#x5F80;&#x4E0B;&#x770B;~ &#x4EB2;&#x624B;&#x5E26;&#x4F60;&#x5256;&#x6790;MVVM&#x539F;&#x7406;!</li>
</ul>
<p>&#x6015;&#x4F60;&#x8D70;&#x5F00;&#x6587;&#x7AE0;&#x672B;&#x5C3E;&#x6709;&#x60CA;&#x559C;&#x7684;&#xFF01;&#x5077;&#x5077;&#x7684;&#x544A;&#x8BC9;&#x4F60;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x662F;&#x6709;<strong>&#x914D;&#x5957;&#x89C6;&#x9891;</strong>&#x7684;&#x54E6;&#xFF01;</p>
<h2 id="t1&#x5148;&#x6765;&#x603B;&#x7ED3;&#x4E0B;MVVM&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;">&#x5148;&#x6765;&#x603B;&#x7ED3;&#x4E0B;MVVM&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F; <a href="#t1&#x5148;&#x6765;&#x603B;&#x7ED3;&#x4E0B;MVVM&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"> # </a></h2>
<ul>
<li>&#x4F20;&#x7EDF;&#x7684;MVC&#x4E2D;&#x901A;&#x8FC7;&#x53D1;&#x5E03;&#x8BA2;&#x9605;&#x6765;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x548C;&#x89C6;&#x56FE;&#x7684;&#x7ED1;&#x5B9A;&#x76D1;&#x542C;</li>
<li>angular1.x&#x4E2D;&#x901A;&#x8FC7;&#x810F;&#x503C;&#x68C0;&#x6D4B;&#x6765;&#x5B9E;&#x73B0;MVVM&#x6A21;&#x5F0F;</li>
<li>&#x76EE;&#x524D;&#x4E3B;&#x6D41;Vue&#x7684;&#x6A21;&#x5F0F;:&#x6570;&#x636E;&#x52AB;&#x6301; Object.defineProperty&#x3001;&#x53D1;&#x5E03;&#x8BA2;&#x9605;</li>
<li>ES6&#x4E2D;&#x7684;&#x65B0;&#x7279;&#x6027;Proxy&#x548C;Reflect</li>
</ul>
<h2 id="t2&#x8C08;&#x8C08;&#x73B0;&#x4EE3;&#x7248;&#x7684;&#x6846;&#x67B6;">&#x8C08;&#x8C08;&#x73B0;&#x4EE3;&#x7248;&#x7684;&#x6846;&#x67B6; <a href="#t2&#x8C08;&#x8C08;&#x73B0;&#x4EE3;&#x7248;&#x7684;&#x6846;&#x67B6;"> # </a></h2>
<p>&#x76F4;&#x63A5;&#x4ECE;&#x4E3B;&#x6D41;&#x7684;&#x8BF4;&#x8D77;&#xFF01;<br>vue&#x7684;&#x7279;&#x70B9;&#x4E0D;&#x5FC5;&#x591A;&#x8BF4;(&#x7B80;&#x5355;&#x6613;&#x7528;)&#x3002;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65B9;&#x4FBF;&#x4E0D;&#x9700;&#x8981;&#x8BB0;&#x5FC6;api&#x65B9;&#x6CD5;,&#x8FD9;&#x90FD;&#x5F52;&#x529F;&#x4E8E;Object.defineProperty,&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x6570;&#x636E;&#x7684;&#x8BBE;&#x7F6E;&#x548C;&#x83B7;&#x53D6;&#x65F6;&#x589E;&#x52A0;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x529F;&#x80FD;&#xFF01;(&#x50CF;&#x5899;&#x4E00;&#x6837;)</p>
<h2 id="t3&#x603B;&#x7ED3;&#x4E0B;&#x5B9E;&#x73B0;MVVM&#x90FD;&#x8981;&#x638C;&#x63E1;&#x54EA;&#x4E9B;&#xFF01;">&#x603B;&#x7ED3;&#x4E0B;&#x5B9E;&#x73B0;MVVM&#x90FD;&#x8981;&#x638C;&#x63E1;&#x54EA;&#x4E9B;&#xFF01; <a href="#t3&#x603B;&#x7ED3;&#x4E0B;&#x5B9E;&#x73B0;MVVM&#x90FD;&#x8981;&#x638C;&#x63E1;&#x54EA;&#x4E9B;&#xFF01;"> # </a></h2>
<ul>
<li>&#x6A21;&#x677F;&#x7F16;&#x8BD1;(Compile)</li>
<li>&#x6570;&#x636E;&#x52AB;&#x6301;(Observer)</li>
<li>&#x53D1;&#x5E03;&#x7684;&#x8BA2;&#x9605;(Dep)</li>
<li>&#x89C2;&#x5BDF;&#x8005;(Watcher)</li>
</ul>
<blockquote>
<p>MVVM&#x6A21;&#x5F0F;&#x5C31;&#x8981;&#x5C06;&#x8FD9;&#x4E9B;&#x677F;&#x5757;&#x8FDB;&#x884C;&#x6574;&#x5408;,&#x5B9E;&#x73B0;&#x6A21;&#x677F;&#x548C;&#x6570;&#x636E;&#x7684;&#x7ED1;&#x5B9A;&#xFF01;</p>
</blockquote>
<p>&#x770B;&#x770B;&#x6211;&#x753B;&#x56FE;&#x7684;&#x529F;&#x5E95;,&#x6709;&#x4E2A;&#x5370;&#x8C61;&#x5C31;&#x597D;&#xFF01;
<img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e41488d37?w=1101&amp;h=642&amp;f=png&amp;s=55016" alt=""></p>
<h2 id="t4&#x5148;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x8BF4;MVVM">&#x5148;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x8BF4;MVVM <a href="#t4&#x5148;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x8BF4;MVVM"> # </a></h2>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e3f24873d?w=865&amp;h=425&amp;f=png&amp;s=102265" alt=""></p>
<ul>
<li>&#x6570;&#x636E;&#x5C31;&#x662F;&#x7B80;&#x5355;&#x7684;javascript&#x5BF9;&#x8C61;,&#x9700;&#x8981;&#x5C06;&#x6570;&#x636E;&#x7ED1;&#x5B9A;&#x5230;&#x6A21;&#x677F;&#x4E0A;</li>
<li>&#x76D1;&#x542C;&#x89C6;&#x56FE;&#x7684;&#x53D8;&#x5316;,&#x89C6;&#x56FE;&#x53D8;&#x5316;&#x540E;&#x901A;&#x77E5;&#x6570;&#x636E;&#x66F4;&#x65B0;,&#x6570;&#x636E;&#x66F4;&#x65B0;&#x4F1A;&#x518D;&#x6B21;&#x5BFC;&#x81F4;&#x89C6;&#x56FE;&#x7684;&#x53D8;&#x5316;&#xFF01;</li>
</ul>
<h2 id="t5Vue&#x57FA;&#x7840;&#x6848;&#x4F8B;">Vue&#x57FA;&#x7840;&#x6848;&#x4F8B; <a href="#t5Vue&#x57FA;&#x7840;&#x6848;&#x4F8B;"> # </a></h2>
<p>&#x770B;&#x6BB5;&#x5927;&#x4F17;&#x4EE3;&#x7801;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x57FA;&#x4E8E;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x641E;&#x4E00;&#x4E0B;MVVM&#x7684;&#x5B9E;&#x73B0;</p>
<pre><code>&lt;div id=&quot;app&quot;&gt;
    &lt;!-- &#x53CC;&#x5411;&#x6570;&#x636E;&#x7ED1;&#x5B9A; &#x9760;&#x7684;&#x662F;&#x8868;&#x5355; --&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;message.a&quot;&gt;
    &lt;div&gt;&#x6211;&#x5F88;&#x5E05;&lt;/div&gt;
    {{message.a}} {{b}}
&lt;/div&gt;
&lt;script src=&quot;watcher.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;observer.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;compile.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;MVVM.JS&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    // &#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x4E00;&#x822C;&#x90FD;&#x6302;&#x8F7D;&#x5728;vm&#x4E0A;
    let vm = new MVVM({
        el:&apos;#app&apos;,
        data:{
            message:{a:&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;},
            b:&apos;&#x73E0;&#x5CF0;MVVM&apos;
        }
    })
&lt;/script&gt;
</code></pre><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;&#x4E86;&#x81EA;&#x5DF1;&#x7684;MVVM&#x5E93;,&#x8FD9;&#x4E2A;&#x5E93;&#x662F;&#x7528;&#x6765;&#x6574;&#x5408;&#x6240;&#x6709;&#x677F;&#x5757;&#x7684;&#xFF01;</p>
<h2 id="t6MVVM&#x6784;&#x5EFA;">MVVM&#x6784;&#x5EFA; <a href="#t6MVVM&#x6784;&#x5EFA;"> # </a></h2>
<p>&#x5BF9;es6&#x8FD8;&#x964C;&#x751F;&#x7684;&#x540C;&#x5B66;,&#x5728;&#x8FD9;&#x6211;&#x5728;&#x7ED9;&#x5927;&#x5BB6;&#x9644;&#x4E2A;<a href="(http://html5train.com/course/manage/1555861/editChapter">&#x7ECF;&#x5178;es6</a>&#x89C6;&#x9891;~
&#x76F4;&#x63A5;&#x7528;ES6&#x6765;&#x6253;&#x9020;&#x6211;&#x4EEC;&#x7684;MVVM</p>
<pre><code>class MVVM{
    constructor(options){
        // &#x4E00;&#x4E0A;&#x6765; &#x5148;&#x628A;&#x53EF;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x6302;&#x8F7D;&#x5728;&#x5B9E;&#x4F8B;&#x4E0A;
        this.$el = options.el;
        this.$data = options.data;
        // &#x5982;&#x679C;&#x6709;&#x8981;&#x7F16;&#x8BD1;&#x7684;&#x6A21;&#x677F;&#x6211;&#x5C31;&#x5F00;&#x59CB;&#x7F16;&#x8BD1;
        if(this.$el){
            // &#x7528;&#x6570;&#x636E;&#x548C;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;
            new Compile(this.$el, this);
        }
    }
}
</code></pre><h2 id="t7&#x6A21;&#x677F;&#x7F16;&#x8BD1;">&#x6A21;&#x677F;&#x7F16;&#x8BD1; <a href="#t7&#x6A21;&#x677F;&#x7F16;&#x8BD1;"> # </a></h2>
<p>MVVM&#x4E2D;&#x8C03;&#x7528;&#x4E86;Compile&#x7C7B;&#x6765;&#x7F16;&#x8BD1;&#x6211;&#x4EEC;&#x7684;&#x9875;&#x9762;,&#x5F00;&#x59CB;&#x6765;&#x5B9E;&#x73B0;&#x6A21;&#x677F;&#x7F16;&#x8BD1;</p>
<p>&#x5148;&#x6765;&#x4E2A;&#x57FA;&#x7840;&#x7684;&#x67B6;&#x5B50;</p>
<pre><code>class Compile {
    constructor(el, vm) {
        // &#x770B;&#x770B;&#x4F20;&#x9012;&#x7684;&#x5143;&#x7D20;&#x662F;&#x4E0D;&#x662F;DOM,&#x4E0D;&#x662F;DOM&#x6211;&#x5C31;&#x6765;&#x83B7;&#x53D6;&#x4E00;&#x4E0B;~
        this.el = this.isElementNode(el) ? el : document.querySelector(el);
        this.vm = vm;
        if (this.el) {
            // &#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x5143;&#x7D20;&#x80FD;&#x83B7;&#x53D6;&#x5230; &#x6211;&#x4EEC;&#x624D;&#x5F00;&#x59CB;&#x7F16;&#x8BD1;
            // 1.&#x5148;&#x628A;&#x8FD9;&#x4E9B;&#x771F;&#x5B9E;&#x7684;DOM&#x79FB;&#x5165;&#x5230;&#x5185;&#x5B58;&#x4E2D; fragment (&#x6027;&#x80FD;&#x4F18;&#x5316;)
            let fragment = this.node2fragment(this.el);
            // 2.&#x7F16;&#x8BD1; =&gt; &#x63D0;&#x53D6;&#x60F3;&#x8981;&#x7684;&#x5143;&#x7D20;&#x8282;&#x70B9; v-model &#x548C;&#x6587;&#x672C;&#x8282;&#x70B9; {{}}
            this.compile(fragment);
            // 3.&#x628A;&#x7F16;&#x8BD1;&#x53F7;&#x7684;fragment&#x5728;&#x585E;&#x56DE;&#x5230;&#x9875;&#x9762;&#x91CC;&#x53BB;
            this.el.appendChild(fragment);
        }
    }
    /* &#x4E13;&#x95E8;&#x5199;&#x4E00;&#x4E9B;&#x8F85;&#x52A9;&#x7684;&#x65B9;&#x6CD5; */
    isElementNode(node) {
        return node.nodeType === 1;
    }
    /* &#x6838;&#x5FC3;&#x7684;&#x65B9;&#x6CD5; */
    compileElement(node) {}
    compileText(node) {}
    compile(fragment) {}
    node2fragment(el) {}
}
</code></pre><p>&#x63A5;&#x4E0B;&#x6765;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x641E;</p>
<h3 id="t8node2fragment">node2fragment <a href="#t8node2fragment"> # </a></h3>
<pre><code>node2fragment(el) { // &#x9700;&#x8981;&#x5C06;el&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5168;&#x90E8;&#x653E;&#x5230;&#x5185;&#x5B58;&#x4E2D;
    // &#x6587;&#x6863;&#x788E;&#x7247; &#x5185;&#x5B58;&#x4E2D;&#x7684;dom&#x8282;&#x70B9;
    let fragment = document.createDocumentFragment();
    let firstChild;
    while (firstChild = el.firstChild) {
        fragment.appendChild(firstChild);
        // appendChild&#x5177;&#x6709;&#x79FB;&#x52A8;&#x6027;
    }
    return fragment; // &#x5185;&#x5B58;&#x4E2D;&#x7684;&#x8282;&#x70B9;
}
</code></pre><h3 id="t9compile">compile <a href="#t9compile"> # </a></h3>
<pre><code>compile(fragment) {
    // &#x9700;&#x8981;&#x9012;&#x5F52; &#x6BCF;&#x6B21;&#x62FF;&#x5B50;&#x5143;&#x7D20;
    let childNodes = fragment.childNodes;
    Array.from(childNodes).forEach(node =&gt; {
        if (this.isElementNode(node)) {
            // &#x662F;&#x5143;&#x7D20;&#x8282;&#x70B9;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x6DF1;&#x5165;&#x7684;&#x68C0;&#x67E5;
            // &#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x5143;&#x7D20;
            this.compileElement(node);
            this.compile(node)
        } else {
            // &#x6587;&#x672C;&#x8282;&#x70B9;
            // &#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x6587;&#x672C;
            this.compileText(node);
        }
    });
}
</code></pre><blockquote>
<p>&#x6211;&#x4EEC;&#x5728;&#x5F04;&#x51FA;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;compileElement,compileText&#x6765;&#x4E13;&#x95E8;&#x5904;&#x7406;&#x5BF9;&#x5E94;&#x7684;&#x903B;&#x8F91;</p>
</blockquote>
<h3 id="t10compileElement&amp;compileText">compileElement&amp;compileText <a href="#t10compileElement&amp;compileText"> # </a></h3>
<pre><code>/*&#x8F85;&#x52A9;&#x7684;&#x65B9;&#x6CD5;*/
// &#x662F;&#x4E0D;&#x662F;&#x6307;&#x4EE4;
isDirective(name) {
    return name.includes(&apos;v-&apos;);
}
----------------------------
compileElement(node) {
    // &#x5E26;v-model v-text 
    let attrs = node.attributes; // &#x53D6;&#x51FA;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x5C5E;&#x6027;
    Array.from(attrs).forEach(attr =&gt; {
        // &#x5224;&#x65AD;&#x5C5E;&#x6027;&#x540D;&#x5B57;&#x662F;&#x4E0D;&#x662F;&#x5305;&#x542B;v-model 
        let attrName = attr.name;
        if (this.isDirective(attrName)) {
            // &#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x653E;&#x5230;&#x8282;&#x70B9;&#x4E2D;
            let expr = attr.value;
            let [, type] = attrName.split(&apos;-&apos;); // 
            // &#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x7F16;&#x8BD1;&#x65B9;&#x6CD5; &#x7F16;&#x8BD1;&#x54EA;&#x4E2A;&#x8282;&#x70B9;,&#x7528;&#x6570;&#x636E;&#x66FF;&#x6362;&#x6389;&#x8868;&#x8FBE;&#x5F0F;
            CompileUtil[type](node, this.vm, expr);
        }
    })
}
compileText(node) {
    let expr = node.textContent; // &#x53D6;&#x6587;&#x672C;&#x4E2D;&#x7684;&#x5185;&#x5BB9;
    let reg = /\{\{([^}]+)\}\}/g; // {{a}} {{b}} {{c}}
    if (reg.test(expr)) { 
        // &#x8C03;&#x7528;&#x7F16;&#x8BD1;&#x6587;&#x672C;&#x7684;&#x65B9;&#x6CD5; &#x7F16;&#x8BD1;&#x54EA;&#x4E2A;&#x8282;&#x70B9;,&#x7528;&#x6570;&#x636E;&#x66FF;&#x6362;&#x6389;&#x8868;&#x8FBE;&#x5F0F;
        CompileUtil[&apos;text&apos;](node, this.vm, expr);
    }
}
</code></pre><h3 id="t11CompileUtil">CompileUtil <a href="#t11CompileUtil"> # </a></h3>
<p>&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7528;&#x6765;&#x914D;&#x5408;Complie&#x7C7B;&#x7684;&#x5DE5;&#x5177;&#x5BF9;&#x8C61;  </p>
<p>&#x5148;&#x53EA;&#x5904;&#x7406;&#x6587;&#x672C;&#x548C;&#x8F93;&#x5165;&#x6846;&#x7684;&#x60C5;&#x51B5;</p>
<pre><code>CompileUtil = {
  text(node, vm, expr) { // &#x6587;&#x672C;&#x5904;&#x7406;
      let updateFn = this.updater[&apos;textUpdater&apos;];
      // &#x7528;&#x5904;&#x7406;&#x597D;&#x7684;&#x8282;&#x70B9;&#x548C;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;
      updateFn &amp;&amp; updateFn(node, value)
  },
  model(node, vm, expr) { // &#x8F93;&#x5165;&#x6846;&#x5904;&#x7406;
        let updateFn = this.updater[&apos;modelUpdater&apos;];
        // &#x7528;&#x5904;&#x7406;&#x597D;&#x7684;&#x8282;&#x70B9;&#x548C;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;
        updateFn &amp;&amp; updateFn(node, value);
  },
  updater: {
      // &#x6587;&#x672C;&#x66F4;&#x65B0;
      textUpdater(node, value) {
          node.textContent = value
      },
      // &#x8F93;&#x5165;&#x6846;&#x66F4;&#x65B0;
      modelUpdater(node, value) {
          node.value = value;
      }
  }
}
</code></pre><p>&#x5B9E;&#x73B0;text&#x65B9;&#x6CD5;</p>
<pre><code>text(node, vm, expr) { // &#x6587;&#x672C;&#x5904;&#x7406;
    let updateFn = this.updater[&apos;textUpdater&apos;];
    // &#x6587;&#x672C;&#x6BD4;&#x8F83;&#x7279;&#x6B8A; expr&#x53EF;&#x80FD;&#x662F;&apos;{{message.a}} {{b}}&apos;
    // &#x8C03;&#x7528;getTextVal&#x65B9;&#x6CD5;&#x53BB;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x7ED3;&#x679C;
    let value = this.getTextVal(vm, expr);
    updateFn &amp;&amp; updateFn(node, value)
},
getTextVal(vm, expr) { // &#x83B7;&#x53D6;&#x7F16;&#x8BD1;&#x6587;&#x672C;&#x540E;&#x7684;&#x7ED3;&#x679C;
    return expr.replace(/\{\{([^}]+)\}\}/g, (...arguments) =&gt; {
        // &#x4F9D;&#x6B21;&#x53BB;&#x53BB;&#x6570;&#x636E;&#x5BF9;&#x5E94;&#x7684;&#x503C;
        return this.getVal(vm, arguments[1]);
    })
},
getVal(vm, expr) { // &#x83B7;&#x53D6;&#x5B9E;&#x4F8B;&#x4E0A;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;
    expr = expr.split(&apos;.&apos;); // {{message.a}} [message,a] &#x5B9E;&#x73B0;&#x4F9D;&#x6B21;&#x53D6;&#x503C;
    // vm.$data.message =&gt; vm.$data.message.a
    return expr.reduce((prev, next) =&gt; { 
        return prev[next];
    }, vm.$data);
}
</code></pre><p>&#x5B9E;&#x73B0;Model&#x65B9;&#x6CD5;</p>
<pre><code>model(node, vm, expr) { // &#x8F93;&#x5165;&#x6846;&#x5904;&#x7406;
    let updateFn = this.updater[&apos;modelUpdater&apos;];
    // &#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x52A0;&#x4E00;&#x4E2A;&#x76D1;&#x63A7; &#x6570;&#x636E;&#x53D8;&#x5316;&#x4E86; &#x5E94;&#x8BE5;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;watch&#x7684;callback 
    updateFn &amp;&amp; updateFn(node, this.getVal(vm, expr));
}
</code></pre><p>&#x770B;&#x4E0B;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6548;&#x679C;^_^</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e417cc7ab?w=449&amp;h=149&amp;f=png&amp;s=5940" alt=""></p>
<h2 id="t12&#x6570;&#x636E;&#x52AB;&#x6301;">&#x6570;&#x636E;&#x52AB;&#x6301; <a href="#t12&#x6570;&#x636E;&#x52AB;&#x6301;"> # </a></h2>
<p>&#x6211;&#x4EEC;&#x4E00;&#x76F4;&#x8BF4;Object.defineProperty&#x6709;&#x52AB;&#x6301;&#x529F;&#x80FD;&#x54B1;&#x5C31;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x662F;&#x600E;&#x6837;&#x52AB;&#x6301;&#x7684;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x7ED9;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x7684;&#x64CD;&#x4F5C;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>
<pre><code>let school = {name:&apos;&apos;}
school.name = &apos;zfpx&apos;;  // &#x5F53;&#x6211;&#x7ED9;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x65F6;&#x5E0C;&#x671B;&#x505A;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;
console.log(school.name); // &#x5F53;&#x6211;&#x83B7;&#x53D6;&#x5C5E;&#x6027;&#x65F6;&#x4E5F;&#x5E0C;&#x671B;&#x5BF9;&#x5E94;&#x6709;&#x5199;&#x64CD;&#x4F5C;
</code></pre><p>&#x8FD9;&#x65F6;&#x5019;Object.defineProperty&#x767B;&#x573A;</p>
<pre><code>let school = {name:&apos;&apos;}
let val;
Object.defineProperty(school, &apos;name&apos;, {
  enumerable: true, // &#x53EF;&#x679A;&#x4E3E;,
  configurable: true, // &#x53EF;&#x914D;&#x7F6E;
  get() {
    // todo
    return val;
  },
  set(newVal) {
    // todo
    val = newVal
  }
});
school.name = &apos;&#x73E0;&#x5CF0;&#x57F9;&#x8BAD;&apos;;
console.log(school.name);
</code></pre><p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x8BBE;&#x7F6E;&#x503C;&#x548C;&#x83B7;&#x53D6;&#x503C;&#x65F6;&#x505A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x505A;&#x7684;&#x64CD;&#x4F5C;&#x4E86;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x5199;&#x4E0B;&#x4E00;&#x4E2A;&#x7C7B;Observer</p>
<pre><code>// &#x5728;MVVM&#x52A0;&#x4E0A;Observe&#x7684;&#x903B;&#x8F91;
if(this.$el){
    // &#x6570;&#x636E;&#x52AB;&#x6301; &#x5C31;&#x662F;&#x628A;&#x5BF9;&#x60F3;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027; &#x6539;&#x6210;get&#x548C;set&#x65B9;&#x6CD5;
    new Observer(this.$data);
    // &#x7528;&#x6570;&#x636E;&#x548C;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;
    new Compile(this.$el, this);
}
--------------------------------------
class Observer{
    constructor(data){
       this.observe(data); 
    }
    observe(data){ 
        // &#x8981;&#x5BF9;&#x8FD9;&#x4E2A;data&#x6570;&#x636E;&#x5C06;&#x539F;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x6539;&#x6210;set&#x548C;get&#x7684;&#x5F62;&#x5F0F;
        // defineProperty&#x9488;&#x5BF9;&#x7684;&#x662F;&#x5BF9;&#x8C61;
        if(!data || typeof data !== &apos;object&apos;){
            return;
        }
        // &#x8981;&#x5C06;&#x6570;&#x636E; &#x4E00;&#x4E00;&#x52AB;&#x6301; &#x5148;&#x83B7;&#x53D6;&#x53D6;&#x5230;data&#x7684;key&#x548C;value
        Object.keys(data).forEach(key=&gt;{
            // &#x5B9A;&#x4E49;&#x54CD;&#x5E94;&#x5F0F;&#x53D8;&#x5316;
            this.defineReactive(data,key,data[key]);
            this.observe(data[key]);// &#x6DF1;&#x5EA6;&#x9012;&#x5F52;&#x52AB;&#x6301;
        });
    }
    // &#x5B9A;&#x4E49;&#x54CD;&#x5E94;&#x5F0F;
    defineReactive(obj,key,value){
        // &#x5728;&#x83B7;&#x53D6;&#x67D0;&#x4E2A;&#x503C;&#x7684;&#x9002;&#x5408; &#x60F3;&#x5F39;&#x4E2A;&#x6846;
        let that = this;
        Object.defineProperty(obj,key,{
            enumerable:true,
            configurable:true,
            get(){ // &#x5F53;&#x53D6;&#x503C;&#x65F6;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;
                return value;
            },
            set(newValue){ // &#x5F53;&#x7ED9;data&#x5C5E;&#x6027;&#x4E2D;&#x8BBE;&#x7F6E;&#x503C;&#x7684;&#x9002;&#x5408; &#x66F4;&#x6539;&#x83B7;&#x53D6;&#x7684;&#x5C5E;&#x6027;&#x7684;&#x503C;
                if(newValue!=value){
                    // &#x8FD9;&#x91CC;&#x7684;this&#x4E0D;&#x662F;&#x5B9E;&#x4F8B; 
                    that.observe(newValue);// &#x5982;&#x679C;&#x662F;&#x8BBE;&#x7F6E;&#x7684;&#x662F;&#x5BF9;&#x8C61;&#x7EE7;&#x7EED;&#x52AB;&#x6301;
                    value = newValue;
                }
            }
        });
    }
}
</code></pre><p>&#x6765;&#x518D;&#x770B;&#x770B;&#x6548;&#x679C;^_^</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e416da8e8?w=784&amp;h=561&amp;f=png&amp;s=72046" alt=""></p>
<h2 id="t13Watcher&#x5B9E;&#x73B0;">Watcher&#x5B9E;&#x73B0; <a href="#t13Watcher&#x5B9E;&#x73B0;"> # </a></h2>
<p>&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x7ED9;&#x9700;&#x8981;&#x53D8;&#x5316;&#x7684;&#x90A3;&#x4E2A;&#x5143;&#x7D20;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x7528;&#x65B0;&#x503C;&#x548C;&#x8001;&#x503C;&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;,&#x5982;&#x679C;&#x6570;&#x636E;&#x53D8;&#x5316;&#x5C31;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;</p>
<pre><code>class Watcher{ // &#x56E0;&#x4E3A;&#x8981;&#x83B7;&#x53D6;&#x8001;&#x503C; &#x6240;&#x4EE5;&#x9700;&#x8981; &quot;&#x6570;&#x636E;&quot; &#x548C; &quot;&#x8868;&#x8FBE;&#x5F0F;&quot;
    constructor(vm,expr,cb){
        this.vm = vm;
        this.expr = expr;
        this.cb = cb;
        // &#x5148;&#x83B7;&#x53D6;&#x4E00;&#x4E0B;&#x8001;&#x7684;&#x503C; &#x4FDD;&#x7559;&#x8D77;&#x6765;
        this.value = this.get();
    }
    // &#x8001;&#x5957;&#x8DEF;&#x83B7;&#x53D6;&#x503C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x5148;&#x4E0D;&#x8FDB;&#x884C;&#x5C01;&#x88C5;
    getVal(vm, expr) { 
        expr = expr.split(&apos;.&apos;); 
        return expr.reduce((prev, next) =&gt; {
            return prev[next];
        }, vm.$data);
    }
    get(){
        let value = this.getVal(this.vm,this.expr);
        return value;
    }
    // &#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x503C;&#x6539;&#x53D8;&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x66F4;&#x65B0;
    update(){
        let newValue = this.getVal(this.vm, this.expr);
        let oldValue = this.value;
        if(newValue != oldValue){
            this.cb(newValue); // &#x5BF9;&#x5E94;watch&#x7684;callback
        }
    }
}
</code></pre><p>&#x5728;&#x54EA;&#x91CC;&#x4F7F;&#x7528;watcher?&#x7B54;&#x6848;&#x80AF;&#x5B9A;&#x662F;compile&#x5440;,&#x7ED9;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x7684;DOM&#x589E;&#x52A0;watcher</p>
<pre><code class="lang-javascript">text(node, vm, expr) { <span class="hljs-comment">// &#x6587;&#x672C;&#x5904;&#x7406;</span>
    <span class="hljs-keyword">let</span> updateFn = <span class="hljs-keyword">this</span>.updater[<span class="hljs-string">&apos;textUpdater&apos;</span>];
    <span class="hljs-keyword">let</span> value = <span class="hljs-keyword">this</span>.getTextVal(vm, expr);
+   expr.replace(<span class="hljs-regexp">/\{\{([^}]+)\}\}/g</span>, (...arguments) =&gt; {
+       <span class="hljs-keyword">new</span> Watcher(vm, <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>],(newValue)=&gt;{
+           <span class="hljs-comment">// &#x5982;&#x679C;&#x6570;&#x636E;&#x53D8;&#x5316;&#x4E86;&#xFF0C;&#x6587;&#x672C;&#x8282;&#x70B9;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x4F9D;&#x8D56;&#x7684;&#x5C5E;&#x6027;&#x66F4;&#x65B0;&#x6587;&#x672C;&#x4E2D;&#x7684;&#x5185;&#x5BB9;</span>
+           updateFn &amp;&amp; updateFn(node,<span class="hljs-keyword">this</span>.getTextVal(vm,expr));
+       });
+   })
    updateFn &amp;&amp; updateFn(node, value)
},
model(node, vm, expr) { <span class="hljs-comment">// &#x8F93;&#x5165;&#x6846;&#x5904;&#x7406;</span>
    <span class="hljs-keyword">let</span> updateFn = <span class="hljs-keyword">this</span>.updater[<span class="hljs-string">&apos;modelUpdater&apos;</span>];
+   <span class="hljs-keyword">new</span> Watcher(vm,expr,(newValue)=&gt;{
+       <span class="hljs-comment">// &#x5F53;&#x503C;&#x53D8;&#x5316;&#x540E;&#x4F1A;&#x8C03;&#x7528;cb &#x5C06;&#x65B0;&#x7684;&#x503C;&#x4F20;&#x9012;&#x8FC7;&#x6765; </span>
+       updateFn &amp;&amp; updateFn(node, newValue);
+   });
    updateFn &amp;&amp; updateFn(node, <span class="hljs-keyword">this</span>.getVal(vm, expr));
}
</code></pre>
<h2 id="t14&#x53D1;&#x5E03;&#x8BA2;&#x9605;">&#x53D1;&#x5E03;&#x8BA2;&#x9605; <a href="#t14&#x53D1;&#x5E03;&#x8BA2;&#x9605;"> # </a></h2>
<p>&#x5982;&#x4F55;&#x5C06;&#x89C6;&#x56FE;&#x548C;&#x6570;&#x636E;&#x5173;&#x8054;&#x8D77;&#x6765;&#x5462;?&#x5C31;&#x662F;&#x5C06;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x548C;&#x5BF9;&#x5E94;&#x7684;watcher&#x5173;&#x8054;&#x8D77;&#x6765;&#x3002;&#x5F53;&#x6570;&#x636E;&#x53D8;&#x5316;&#x65F6;&#x8BA9;&#x5BF9;&#x5E94;&#x7684;watcher&#x6267;&#x884C;update&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#xFF01;&#x518D;&#x60F3;&#x60F3;&#x5728;&#x54EA;&#x505A;&#x64CD;&#x4F5C;&#x5462;&#xFF1F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;set&#x548C;get!</p>
<p>Dep&#x5B9E;&#x73B0;</p>
<pre><code>class Dep{
    constructor(){
        // &#x8BA2;&#x9605;&#x7684;&#x6570;&#x7EC4;
        this.subs = []
    }
    addSub(watcher){
        this.subs.push(watcher);
    }
    notify(){
        this.subs.forEach(watcher=&gt;watcher.update());
    }
}
</code></pre><p>&#x5173;&#x8054;dep&#x548C;watcher</p>
<p>watcher&#x4E2D;&#x6709;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x662F;this.get();&#x6BCF;&#x4E2A;watcher&#x88AB;&#x5B9E;&#x4F8B;&#x5316;&#x65F6;&#x90FD;&#x4F1A;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x4ECE;&#x800C;&#x4F1A;&#x8C03;&#x7528;&#x5F53;&#x524D;&#x5C5E;&#x6027;&#x7684;get&#x65B9;&#x6CD5;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// watcher&#x4E2D;&#x7684;get&#x65B9;&#x6CD5;</span>
get(){
    <span class="hljs-comment">// &#x5728;&#x53D6;&#x503C;&#x524D;&#x5148;&#x5C06;watcher&#x4FDD;&#x5B58;&#x5230;Dep&#x4E0A;</span>
    Dep.target = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">let</span> value = <span class="hljs-keyword">this</span>.getVal(<span class="hljs-keyword">this</span>.vm,<span class="hljs-keyword">this</span>.expr); <span class="hljs-comment">// &#x4F1A;&#x8C03;&#x7528;&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x7684;get&#x65B9;&#x6CD5;</span>
    Dep.target = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> value;
}
<span class="hljs-comment">// &#x66F4;&#x65B0;Observer&#x4E2D;&#x7684;defineReactive</span>
defineReactive(obj,key,value){
    <span class="hljs-keyword">let</span> that = <span class="hljs-keyword">this</span>;
+   <span class="hljs-keyword">let</span> dep = <span class="hljs-keyword">new</span> Dep(); <span class="hljs-comment">// &#x6BCF;&#x4E2A;&#x53D8;&#x5316;&#x7684;&#x6570;&#x636E; &#x90FD;&#x4F1A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;,&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x662F;&#x5B58;&#x653E;&#x6240;&#x6709;&#x66F4;&#x65B0;&#x7684;&#x64CD;&#x4F5C;</span>
    <span class="hljs-built_in">Object</span>.defineProperty(obj,key,{
        <span class="hljs-attr">enumerable</span>:<span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>:<span class="hljs-literal">true</span>,
        get(){ <span class="hljs-comment">// &#x5F53;&#x53D6;&#x503C;&#x65F6;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span>
            Dep.target &amp;&amp; dep.addSub(Dep.target);
            <span class="hljs-keyword">return</span> value;
        },
        set(newValue){
            <span class="hljs-keyword">if</span>(newValue!=value){
                that.observe(newValue);
                value = newValue;
                dep.notify(); <span class="hljs-comment">// &#x901A;&#x77E5;&#x6240;&#x6709;&#x4EBA; &#x6570;&#x636E;&#x66F4;&#x65B0;&#x4E86;</span>
            }
        }
    });
}
</code></pre>
<p>&#x5230;&#x6B64;&#x6570;&#x636E;&#x548C;&#x89C6;&#x56FE;&#x5C31;&#x5173;&#x8054;&#x8D77;&#x6765;&#x4E86;&#xFF01;^_^</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e4173e293?w=958&amp;h=243&amp;f=png&amp;s=40102" alt=""></p>
<h2 id="t15&#x76D1;&#x542C;&#x8F93;&#x5165;&#x4E8B;&#x4EF6;">&#x76D1;&#x542C;&#x8F93;&#x5165;&#x4E8B;&#x4EF6; <a href="#t15&#x76D1;&#x542C;&#x8F93;&#x5165;&#x4E8B;&#x4EF6;"> # </a></h2>
<pre><code class="lang-javascript">setVal(vm,expr,value){ 
    expr = expr.split(<span class="hljs-string">&apos;.&apos;</span>);
    <span class="hljs-keyword">return</span> expr.reduce(<span class="hljs-function">(<span class="hljs-params">prev,next,currentIndex</span>)=&gt;</span>{
        <span class="hljs-keyword">if</span>(currentIndex === expr.length<span class="hljs-number">-1</span>){
            <span class="hljs-keyword">return</span> prev[next] = value;
        }
        <span class="hljs-keyword">return</span> prev[next];
    },vm.$data);
},
model(node, vm, expr) {
    <span class="hljs-keyword">let</span> updateFn = <span class="hljs-keyword">this</span>.updater[<span class="hljs-string">&apos;modelUpdater&apos;</span>];
    <span class="hljs-keyword">new</span> Watcher(vm,expr,(newValue)=&gt;{
        <span class="hljs-comment">// &#x5F53;&#x503C;&#x53D8;&#x5316;&#x540E;&#x4F1A;&#x8C03;&#x7528;cb &#x5C06;&#x65B0;&#x7684;&#x503C;&#x4F20;&#x9012;&#x8FC7;&#x6765; &#xFF08;&#xFF09;</span>
        updateFn &amp;&amp; updateFn(node, <span class="hljs-keyword">this</span>.getVal(vm, expr));
    });
+   node.addEventListener(<span class="hljs-string">&apos;input&apos;</span>,(e)=&gt;{
+       <span class="hljs-keyword">let</span> newValue = e.target.value;
+       <span class="hljs-comment">// &#x76D1;&#x542C;&#x8F93;&#x5165;&#x4E8B;&#x4EF6;&#x5C06;&#x8F93;&#x5165;&#x7684;&#x5185;&#x5BB9;&#x8BBE;&#x7F6E;&#x5230;&#x5BF9;&#x5E94;&#x6570;&#x636E;&#x4E0A;</span>
+       <span class="hljs-keyword">this</span>.setVal(vm,expr,newValue)
+   });
    updateFn &amp;&amp; updateFn(node, <span class="hljs-keyword">this</span>.getVal(vm, expr));
}
</code></pre>
<h2 id="t16&#x4EE3;&#x7406;&#x6570;&#x636E;">&#x4EE3;&#x7406;&#x6570;&#x636E; <a href="#t16&#x4EE3;&#x7406;&#x6570;&#x636E;"> # </a></h2>
<pre><code>class MVVM{
    constructor(options){
        this.$el = options.el;
        this.$data = options.data;
        if(this.$el){
            new Observer(this.$data);
            // &#x5C06;&#x6570;&#x636E;&#x4EE3;&#x7406;&#x5230;&#x5B9E;&#x4F8B;&#x4E0A;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x5B9E;&#x4F8B;&#x5373;&#x53EF;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x901A;&#x8FC7;vm.$data&#x6765;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;
            this.proxyData(this.$data);
            new Compile(this.$el, this);
        }
    }
    proxyData(data){
        Object.keys(data).forEach(key=&gt;{
            Object.defineProperty(this,key,{
                get(){
                    return data[key]
                },
                set(newValue){
                    data[key] = newValue
                }
            })
        })
    }
}
</code></pre><p>&#x770B;&#x770B;&#x6700;&#x7EC8;&#x6548;&#x679C;!</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/5/7/16339e3e44695200?w=686&amp;h=286&amp;f=png&amp;s=27377" alt=""></p>
<hr>
<p>MVVM&#x76F8;&#x5173;&#x89C6;&#x9891;:<br><a href="http://www.html5train.com/kecheng/detail_1553514">Vue&#x3001;MVC&#x3001;Angular&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x7684;&#x5B9E;&#x73B0;</a></p>
<p>&#x5173;&#x6CE8;&#x6211;&#x4EEC;&#x73E0;&#x5CF0;&#x57F9;&#x8BAD;&#x67B6;&#x6784;&#x8BFE;&#x7A0B;: QQ&#x7FA4;&#x53F7;:464438594<br>&#x65B0;&#x4E00;&#x671F;&#x5F00;&#x8BFE;&#x65F6;&#x95F4;: 5&#x6708;12&#x65E5;&#x5468;&#x516D;&#x5168;&#x5929;&#x514D;&#x8D39;&#x8BD5;&#x542C;</p>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>
    
</div>

<script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.js"></script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
  // if (!$('.understand-me').length) {
  //   var bar = $(window).height() - $('.navbar ').height() - $('.page-toc').position().top;
  //   var count = bar / 26 / 2;
  //   var barHeight = $('.page-toc').outerHeight();
  //   $('.page-toc li').eq(0).children('a').addClass('red');
  //   var arr = [];
  //   $("h1,h2,h3,h4,h5,h6").each(function () {
  //     arr.push($(this).position().top);
  //   });
  //   var timer
  //   function dark() {
  //     clearTimeout(timer)
  //      timer = setTimeout(function () {
  //      var top = Math.abs($('.page-toc > ul').position().top);
  //      var cur = $('.content').scrollTop();
  //      for (var i = arr.length; i >= 0; i--) {
  //        if (arr[i] <= cur) {
  //          break;
  //        }
  //      }
  //      if (i === -1) {
  //        i = 0;
  //      }
  //      $('.page-toc li a').removeClass('red');
  //      $('.page-toc li').eq(i).children('a').addClass('red');
  //      let height = $('.page-toc li').eq(i).position().top-$('.page-toc').height(); // 如果当前的offset出去了 回到中间可好？
  //      $('.page-toc').scrollTop(height+$('.page-toc').height()/2);
  //    },200)
  //   }

  //   $('.content').on('scroll', dark);
  // }
</script>
<style>

    /* ::-webkit-scrollbar{width:14px;}
    ::-webkit-scrollbar-track{background-color:transparent;}
    ::-webkit-scrollbar-thumb{background-color:transparent;}
    ::-webkit-scrollbar-thumb:hover {background-color:transparent}
    ::-webkit-scrollbar-thumb:active {background-color:transparent} */

    .page-toc > ul .red {
        background: #f3f3f3;
        z-index: 1;
        border-left: 3px solid #009a61;
        -webkit-transition: all .2s ease;
        transition: all .2s ease;
        color: #000
    }





</style>
</body>
</html>
